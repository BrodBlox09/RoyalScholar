<!DOCTYPE html>
<html lang="en">

<head>
    <base target="_blank">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* #region Session Search Bar */
        #session-search-bar {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: var(--max-content-width);
            margin-inline: auto;
        }

        /* #region Search */
        #session-search-wrapper {
            --color: var(--primary);
            position: relative;
            display: flex;
            border-radius: 1lh;
            padding-inline: 10px;
            border: 3px solid var(--color);
            overflow: clip;
            background: #FFFFFF;
            transition: all 0.2s;
        }

        #session-search {
            font-family: var(--body-font);
            font-size: 1.25em;
            padding: 10px;
            color: #333333;
            outline: none;
            border: none;
            width: 100%;
            box-sizing: border-box;
        }

        #search-icon {
            padding-right: 10px;
            display: flex;
            align-items: center;
            fill: var(--color);
            transition: all 0.2s;
        }

        #session-search-wrapper:focus-within {
            --color: var(--primary-dark);
        }

        #no-sessions-found {
            display: none;
            text-align: center;
            max-width: 600px;
            margin-inline: auto;
        }

        .no-sessions-found-reason {
            display: none;
        }

        .no-sessions-found-reason.active {
            display: block;
        }
        /* #endregion */

        /* #region Tags */
        #filter-list {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        #filter-list > div {
            border-radius: 1lh;
            background-color: #FFFFFF;
            border: 1px solid var(--gray);
            padding: 5px;
            padding-inline: 10px;
        }

        #filter-list > div > p {
            margin: 0;
            user-select: none;
        }

        #filter-list > div#add-filter-button {
            position: relative;
        }

        #filter-list > div#add-filter-button > #add-filter-menu {
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            display: none;
            flex-direction: column;
            gap: 5px;
            background-color: #FFFFFF;
            border-radius: 10px;
            padding: 10px;
            box-shadow: var(--soft-box-shadow);
        }

        #filter-list > div#add-filter-button > #add-filter-menu.active {
            display: flex;
        }

        #filter-list > div#add-filter-button > #add-filter-menu > p {
            margin: 0;
        }
        /* #endregion */
        /* #endregion */

        #session-card-list {
            padding: 1rem;
            padding-top: 0;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: var(--max-content-width);
            margin-inline: auto;
        }

        /* #region Session Card */
        .session-card {
            border-radius: 20px;
            box-shadow: var(--soft-box-shadow);
            border: var(--soft-border);
            padding: 1rem;
            background: #FFFFFF;
        }

        .session-card>div.session-card-top {
            display: flex;
            justify-content: space-between;
        }

        .session-card>div.session-card-top .session-card-class {
            font-size: 1.17rem;
            margin: 0;
        }
        .session-card>div.session-card-top .session-card-subject {
            font-size: 0.9rem;
            margin: 0;
            font-weight: 400;
            color: #555;
        }

        .session-card>div.session-card-top .session-card-details-button {
            display: flex;
            align-items: center;
            gap: 5px;
            padding-left: 15px;
            padding-right: 15px;
        }

        .session-card>div.session-card-top .session-card-details-button>svg {
            height: 1.1rem;
            stroke: currentColor;
        }

        .session-card div.icon-bullet {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--gray);
        }

        .session-card div.icon-bullet>svg {
            height: 1rem;
            width: 1rem;
            stroke: currentColor;
        }

        .session-card div.icon-bullet>p {
            font-size: 1rem;
            margin: 0;
            color: var(--gray);
        }
        /* #endregion */
    </style>
</head>

<body>
    <div id="topnav"></div>
    <div id="session-search-bar">
        <div id="session-search-wrapper">
            <input id="session-search" placeholder="Search sessions">
            <div id="search-icon">
                <svg height="24px" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M4 9a5 5 0 1110 0A5 5 0 014 9zm5-7a7 7 0 104.2 12.6.999.999 0 00.093.107l3 3a1 1 0 001.414-1.414l-3-3a.999.999 0 00-.107-.093A7 7 0 009 2z">
                    </path>
                </svg>
            </div>
        </div>
        <!-- <div id="filter-list">
            <div id="add-filter-button">
                <p>+ Add Filters</p>
                <div id="add-filter-menu">
                    <p>Subject</p>
                    <p>Time</p>
                </div>
            </div>
        </div> -->
    </div>
    <div id="session-card-list">
        
    </div>
    <div id="no-sessions-found">
        <h2>No sessions found</h2>
        <p id="no-sessions-found-reason-search" class="no-sessions-found-reason">Try rewording your search terms or removing some filters.</p>
        <p id="no-sessions-found-reason-none" class="no-sessions-found-reason">Come back later to see new sessions once they are requested. You'll be notified for any subjects/classes that you've marked you have a preference for.</p>
    </div>
    <template id="session-card-template">
        <div class="session-card">
            <div class="session-card-top">
                <div>
                    <h2 class="session-card-class">Class</h2>
                    <h3 class="session-card-subject">Subject</h3>
                </div>
                <div>
                    <a href="link-to-full-screen-details-page.html" class="button session-card-details-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-arrow-out-up-right-icon lucide-square-arrow-out-up-right"><path d="M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6"/><path d="m21 3-9 9"/><path d="M15 3h6v6"/></svg>
                        Details
                    </a>
                </div>
            </div>
            <div class="icon-bullet">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days-icon lucide-calendar-days"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
                <p class="session-card-formatted-time">Time</p>
            </div>
            <div class="icon-bullet">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-graduation-cap-icon lucide-graduation-cap"><path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z"/><path d="M22 10v6"/><path d="M6 12.5V16a6 3 0 0 0 12 0v-3.5"/></svg>
                <p class="session-card-student-name">Name</p>
            </div>
            <div class="icon-bullet">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users-icon lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><path d="M16 3.128a4 4 0 0 1 0 7.744"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><circle cx="9" cy="7" r="4"/></svg>
                <p class="session-card-signed-up-tutors-count">#</p>
            </div>
        </div>
    </template>
    <script src="scripts.js"></script>
    <script>
        let sessionCardTemplate = document.getElementById("session-card-template");
        let sessionCardList = document.getElementById("session-card-list");
        let noSessionsFound = document.getElementById("no-sessions-found");
        let sessions = [];

        let searchBar = document.getElementById("session-search");
        searchBar.addEventListener("input", updateSessionCards);
        searchBar.value = "";

        // let addTagButton = document.getElementById("add-filter-button");
        // let addTagMenu = document.getElementById("add-filter-menu");
        // document.addEventListener("click", () => {
        //     addTagMenu.classList.remove("active");
        // });
        // addTagButton.addEventListener("click", (e) => {
        //     addTagMenu.classList.add("active");
        //     e.stopPropagation();
        // });

        function updateSessionCards() {
            let visibleSessions = sessions;
            // Sort sessions by start time (soonest starting first), then by end time (latest ending first)
            visibleSessions = visibleSessions.sort((a, b) => new Date(a.start) - new Date(b.start) || new Date(b.end) - new Date(a.end));
            // Filter sessions by search
            let searchQuery = searchBar.value;
            visibleSessions = visibleSessions.filter((/** @type {{subject: string, href: string, time: string, studentName: string}} */ session) => {
                let query = searchQuery;
                { // Subject
                    let subjectQuery = /subject:([^ ]*)/.exec(query);
                    if (subjectQuery) {
                        subjectQuery = subjectQuery[1];
                        if (!testStringsLoose(session.subject, subjectQuery)) return false;
                        query = "".replace(/ ?subject:[^ ]* ?/, '');
                    }
                }
                { // Class
                    let classQuery = /class:([^ ]*)/.exec(query);
                    if (classQuery) {
                        classQuery = classQuery[1];
                        if (!testStringsLoose(session.className, classQuery)) return false;
                        query = "".replace(/ ?class:[^ ]* ?/, '');
                    }
                }
                if (query == "") return true;
                for (let key in session) {
                    if (key == "href") continue;
                    let value = session[key];
                    if (testStringsLoose(value, query)) return true;
                }
            });
            sessionCardList.innerHTML = "";
            if (visibleSessions.length == 0) {
                noSessionsFound.style.display = "block";
                if (sessions.length == 0) { // No sessions at all
                    noSessionsFound.querySelector("#no-sessions-found-reason-none").classList.add("active");
                    noSessionsFound.querySelector("#no-sessions-found-reason-search").classList.remove("active");
                } else { // No sessions matching search
                    noSessionsFound.querySelector("#no-sessions-found-reason-none").classList.remove("active");
                    noSessionsFound.querySelector("#no-sessions-found-reason-search").classList.add("active");
                }
            } else {
                noSessionsFound.style.display = "none";
            }
            visibleSessions.forEach(session => {
                /** @type {HTMLElement} */
                let card = sessionCardTemplate.content.cloneNode(true);
                card.querySelector(".session-card-class").textContent = session.classData.name;
                card.querySelector(".session-card-subject").textContent = session.classData.subject;
                card.querySelector(".session-card-details-button").href = session.href;
                card.querySelector(".session-card-formatted-time").textContent = session.formattedTime;
                card.querySelector(".session-card-student-name").textContent = session.studentName;
                card.querySelector(".session-card-signed-up-tutors-count").textContent = `${session.signedUpTutorsCount } tutor${session.signedUpTutorsCount == 1 ? "" : "s"} signed up`;

                sessionCardList.appendChild(card);
            });
        }

        function testStringsLoose(str1, str2) {
            return str1.toLowerCase().includes(str2.toLowerCase()) || str2.toLowerCase().includes(str1.toLowerCase());
        }

        // #debug
        sessions = [
            {
                "classData": {name: "AP Calculus AB", subject: "Math"},
                "href": "https://www.youtube.com/watch?v=iadofnvo4",
                "formattedTime": "September 30, Seminar Session 1",
                "startTime": "2025-02-13T22:31:00",
                "studentName": "Brody Smalley",
                "signedUpTutorsCount": 0
            },
            {
                "classData": {name: "AP English Composition", subject: "English"},
                "href": "https://www.youtube.com/watch?v=iadofnvo4",
                "formattedTime": "September 30, Seminar Session 1",
                "startTime": "2025-02-13T22:31:00",
                "studentName": "Maya Gilhooly",
                "signedUpTutorsCount": 1
            }
        ];
        // #enddebug

        // #debug
        /*
        // #enddebug
        sessions = <?!= sessionInfo ?>;
        // #debug
        */
        // #enddebug

        updateSessionCards();
    </script>
</body>

</html>
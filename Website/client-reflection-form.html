<!DOCTYPE html>
<html lang="en">

<head>
    <base target="_blank">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Reflection Form</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            display: flex;
            flex-direction: column;
        }

        #content {
            background-color: var(--accent-soft);
            flex-grow: 1;
            display: grid;
            place-items: center;
        }

        #box {
            width: 75%;
            min-width: 600px;
            box-sizing: border-box;
            position: relative;
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 32px;
            border-radius: 20px;
            background-color: #ffffff;
            box-shadow: var(--soft-box-shadow);
        }

        #box-pages {
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        #box-page-slider {
            --currentPageIndex: 0;
            translate: calc(var(--currentPageIndex) * -1 * (100% + 100px) / var(--pages));
            transition: 1s translate;
            display: flex;
            gap: 100px;
            width: calc(var(--pages) * 100% + (var(--pages) - 1) * 100px);
        }

        .box-page {
            padding-right: 1px;
            /* Fix floating point precission error */
            width: 100%;
        }
        #session-details {
            margin-bottom: 16px;
        }

        #session-details p {
            margin: 0;
        }

        .bottom-button {
            display: flex;
            justify-content: end;
            margin-top: 10px;
        }

        @media screen and (max-width: 600px) {
            #box {
                width: 100%;
                min-width: 0;
                min-height: 75%;
                border-radius: 0;
            }
        }
    </style>
</head>

<body>
    <div id="topnav"></div>
    <div id="content">
        <div id="box">
            <div id="box-pages">
                <div id="box-page-slider" style="--pages: 2;">
                    <div class="box-page">
                        <div id="form-title">
                            <h1 class="heading">Client Reflection Form</h1>
                            <h2 class="subheading">Let us know how we did! Your tutor cannot view your response.</h2>
                        </div>
                        <div id="session-details">
                            <h2 class="heading">Session Details</h2>
                            <p><strong>Date:</strong> <span id="session-date">Date</span></p>
                            <p><strong>Time:</strong> <span id="session-time">Time</span></p>
                            <p><strong>Tutor:</strong> <span id="session-tutor">Tutor</span></p>
                            <p><strong>Class:</strong> <span id="session-class">Class</span></p>
                        </div>
                        <div id="input-section">
                            <label for="worked-on-input">What was worked on?</label>
                            <textarea class="textarea-input" id="worked-on-input" placeholder="We worked on reviewing the Pythagorean Theorem."></textarea>
                            <label for="like-input">What did you like?</label>
                            <textarea class="textarea-input" id="like-input" placeholder="The tutor was very patient."></textarea>
                            <label for="dislike-input">What did you dislike?</label>
                            <textarea class="textarea-input" id="dislike-input" placeholder="Nothing!"></textarea>
                        </div>
                        <div class="bottom-button">
                            <button class="button" id="submit-button" disabled>
                                Submit
                                <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" transform="matrix(-2, 0, 0, -2, 0, 0)rotate(0)"><path id="Vector" d="M13 15L10 12L13 9" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                            </button>
                        </div>
                    </div>
                    <div class="box-page center-vert">
                        <div class="title-section">
                            <h1 class="heading" id="submit-form-page-title">Submitting...</h1>
                            <p id="submit-form-page-text"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="scripts.js"></script>
    <script>
        let sessionDateText = document.getElementById("session-date");
        let sessionTimeText = document.getElementById("session-time");
        let sessionTutorText = document.getElementById("session-tutor");
        let sessionClassText = document.getElementById("session-class");
        let workedOnInput = document.getElementById("worked-on-input");
        let likeInput = document.getElementById("like-input");
        let dislikeInput = document.getElementById("dislike-input");
        let submitButton = document.getElementById("submit-button");
        let submitFormPageTitle = document.getElementById("submit-form-page-title");
        let submitFormPageText = document.getElementById("submit-form-page-text");
        const pageSlider = document.getElementById("box-page-slider");
        let sid;

        function setPage(pageNumber) { pageSlider.style.setProperty("--currentPageIndex", pageNumber - 1); }

        submitButton.addEventListener("click", () => {
            let workedOn = workedOnInput.value.trim();
            let liked = likeInput.value.trim();
            let disliked = dislikeInput.value.trim();
            setPage(2);
            sendAPIReq({
                reqType: "submitSessionReflectionForm",
                type: "client",
                workedOn: workedOn,
                liked: liked,
                disliked: disliked
            }, (res) => {
                submitFormPageTitle.textContent = "Form submitted!";
                submitFormPageText.textContent = "Thank you for filling out your Client Reflection Form!";
            }, (err) => {
                submitFormPageTitle.textContent = `Error ${err.errorCode}`;
                submitFormPageText.textContent = err.error;
                return false;
            });
        });

        workedOnInput.addEventListener("input", updateSubmitButtonState);
        likeInput.addEventListener("input", updateSubmitButtonState);
        dislikeInput.addEventListener("input", updateSubmitButtonState);

        function updateSubmitButtonState() {
            submitButton.disabled = !(workedOnInput.value.length > 0 && likeInput.value.length > 0 && dislikeInput.value.length > 0);
        }

        function fillInSessionDetails(sessionDetails) {
            sid = sessionDetails.sid;
            sessionDateText.textContent = formatDate(sessionDetails.date);
            sessionTimeText.textContent = sessionDetails.name == "Custom Session" ? `${formatTime(sessionDetails.start)} - ${formatTime(sessionDetails.end)}` : sessionDetails.name;
            sessionTutorText.textContent = sessionDetails.tutorName;
            sessionClassText.textContent = sessionDetails.className;
            updateSubmitButtonState();
        }

        function formatDate(time, formatShort) {
            let options = { dateStyle: "full" };
            if (formatShort) options.dateStyle = "medium";
            let dateFormatter = Intl.DateTimeFormat({ region: "en-us" }, options);

            return dateFormatter.format(new Date(time));
        }

        function formatTime(time) {
            let timeFormatter = Intl.DateTimeFormat({ region: "en-us" }, { timeStyle: "short", hour12: false });

            return timeFormatter.format(new Date(time));
        }

        // #debug
        fillInSessionDetails({
            tutorName: "Example Student",
            date: "Sep 28 2025",
            start: 1740744900000,
            end: 1740749400000,
            name: "September 28, Seminar Session 1",
            className: "AP Seminar+",
            sid: 40444
        });
        // #enddebug

        // #debug
        /*
        // #enddebug
        fillInSessionDetails(<?!= sessionDetails ?>);
        // #debug
        */
        // #enddebug
    </script>
</body>

</html>
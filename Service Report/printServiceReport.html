<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoyalScholar Service Report</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');

        head,
        body {
            margin: 0;
            padding: 0;
        }

        h1, h2 {
            font-family: "Playfair Display";
            margin: 0;
        }

        p, a, td, th {
            font-family: Merriweather, 'Times New Roman', Times, serif;
        }

        .paper {
            min-height: 100vh; /* Make the paper at least one page in height, when more than one it will only fill the page up to where needed */
            /* Would prefer to find a solution that fills the last paper to the max so that the footer always goes to the bottom of the screen */
            position: relative;
        }

        #service-report {
            display: flex;
            flex-direction: column;
        }

        #content {
            flex-grow: 1;
        }

        /* #region Headers */
        #header {
            -webkit-page-break-before: avoid-page;
            page-break-before: avoid-page;
            -webkit-break-before: avoid-page;
            break-before: avoid-page;
            -webkit-page-break-inside: avoid-page;
            page-break-inside: avoid-page;
            -webkit-break-inside: avoid-page;
            break-inside: avoid-page;
            -webkit-page-break-after: avoid-page;
            page-break-after: avoid-page;
            -webkit-break-after: avoid-page;
            break-after: avoid-page;
        }

        #header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #header-row img {
            height: 2.5em;
        }

        #header-line {
            width: 100%;
            height: 3px;
            background-color: #000000;
            border-radius: 5px;
            margin-block: 10px;
        }

        #subheader-info-block {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        #subheader-info-block p {
            margin: 0;
        }
        /* #endregion */

        /* #region Table */
        table {
            width: 100%;
            border-collapse: collapse;
            padding: 0;
            margin-bottom: 10px;
        }
        th {
            background-color: #3F51B5;
            font-weight: 600;
            color: #FFFFFF;
        }
        th, td {
            border: 1px solid #222e72;
            padding-inline: 10px;
        }
        tr:nth-child(2n) td { /* Even rows */
            background-color: #ddeaf7;
        }
        tr:nth-child(2n+1) td { /* Odd rows */
            background-color: #caddf0;
        }
        tr td.empty-cell {
            border: none;
            background-color: transparent;
        }

        #service-table td:nth-child(6) {
            /* These styles only apply to the hours column */
            text-align: right;
        }
        /* #endregion */

        /* #region Footer */
        #footer {
            flex-shrink: 0;
            display: grid;
            place-items: center;
            -webkit-break-inside: avoid-page;
            break-before: auto;
            break-inside: avoid-page;
        }

        #verify-footer {
            background-color: #004AAC;
            color: #FFFFFF;
            padding: 20px;
            display: grid;
            grid-template-rows: 1fr;
            grid-template-columns: auto auto;
            gap: 20px;
        }

        #verify-qr-code {
            aspect-ratio: 1 / 1;
            width: 20vw;
        }

        #verify-text a {
            color: #FFFFFF;
        }
        /* #endregion */

        thead { display: table-header-group; }
        
        @media print {
            * {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
        }

        @page {
            /* Forces portrait orientation on Firefox and Chrome */
            size: portrait;
            /* Decreases page margins to 20px */
            margin: 20px;
            /* Hides header and footer metadata text on Chrome */
            @top-left { content: ''; }
            @bottom-left { content: ''; }
            /* Breaks VSCode syntax highlighting without this comment bc the above are not registered as valid at-rules yet */
        }
    </style>
</head>
<body>
    <div class="paper" id="service-report">
        <div id="content">
            <div id="header">
                <div id="header-row">
                    <h1>RoyalScholar Service Report (SRID-<span class="srid">XXXXX</span>)</h1>
                    <img src="../Graphics/Logos/blackFullLogo.png">
                </div>
                <div id="header-line"></div>
                <div id="subheader-info-block">
                    <p><b>Date Range:</b> <span id="date-range">XX/XX/XXXX - XX/XX/XXXX</span></p>
                    <p><b>Date Range Type:</b> <span id="date-range-type">TYPE</span></p>
                    <p><b>Date of Generation:</b> <span id="date-generated">XX/XX/XXXX</span></p>
                    <p><b>Session Count:</b> <span id="session-count">XX</span></p>
                    <p style="grid-column: span 2;"><b>Student:</b> <span id="student-name">-----</span></p>
                </div>
            </div>
            <table id="service-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>SID</th>
                        <th>Session Name</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Hours</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div id="footer">
            <div id="verify-footer">
                <img src="verifyServiceReport.png" id="verify-qr-code">
                <div id="verify-text">
                    <h2 id="verify-header">Verify this Report</h2>
                    <p>To verify this RoyalScholar Service Report, go to
                        <a href="https://sites.google.com/student.dodea.edu/royalscholar/verify-service-report">https://sites.google.com/student.dodea.edu/royalscholar/verify-service-report</a>
                        or scan the QR code on the left. Then enter SRID-<span class="srid">XXXXX</span> to view this report.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
        try {
        const HOUR = 1000 * 60 * 60;
        let dateFormatter = new Intl.DateTimeFormat('en-GB', {dateStyle:"long"});
        function formatDate(timeStr) {
            let time = new Date(timeStr);
            return dateFormatter.format(time);
        }

        let timeFormatter = new Intl.DateTimeFormat('en-GB', {timeStyle:"medium"});
        function formatTime(timeStr) {
            let time = new Date(timeStr);
            return timeFormatter.format(time);
        }

        function formatNumber(num) {
            return num.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }
        
        let serviceReportId = 39573;
        let serviceReportData = {"student":"Brody Smalley <bsma3924@student.dodea.edu>","dateRangeInfo":{"name":"SY 24-25 S1","start":"August 19, 2024","end":"January 16, 2025"},"sessionData":[{"sid":87436,"name":"June 6, Seminar Session 1","start":"2025-06-06T11:45:00.000Z","end":"2025-06-06T12:20:00.000Z"}],"generated":"2025-07-06T12:20:00.000Z"};
        let sessionData = serviceReportData.sessionData;
        // For testing, inject false data
        sessionData = new Array(600).fill(sessionData[0]);

        for (let srid of document.getElementsByClassName("srid")) {
            srid.textContent = serviceReportId;
        }

        let serviceReportRange = serviceReportData.dateRangeInfo;
        document.getElementById("date-range").textContent = `${formatDate(serviceReportRange.start)} - ${formatDate(serviceReportRange.end)}`;
        document.getElementById("date-range-type").textContent = serviceReportRange.name;
        document.getElementById("date-generated").textContent = `${formatDate(serviceReportData.generated)} ${formatTime(serviceReportData.generated)}`;
        document.getElementById("session-count").textContent = sessionData.length;
        document.getElementById("student-name").textContent = serviceReportData.student; // Follow RFC5322 guidelines 'Name <email>'

        let serviceTable = document.getElementById("service-table").createTBody();
        let totalHours = 0;

        sessionData.forEach(session => {
            let fdate = formatDate(session.start);
            let fstart = formatTime(session.start);
            let fend = formatTime(session.end);
            let elapsed = (Date.parse(session.end) - Date.parse(session.start)) / HOUR;
            totalHours += elapsed;
            let felapsed = formatNumber(elapsed);
            let data = [fdate, session.sid, session.name, fstart, fend, felapsed];
            serviceTable.insertRow().innerHTML = data.reduce((acc, curr) => {
                return acc + `<td>${curr}</td>`;
            }, "");
        });
        serviceTable.insertRow().innerHTML = `
                            <td class="empty-cell"></td>
                            <td class="empty-cell"></td>
                            <td class="empty-cell"></td>
                            <td class="empty-cell"></td>
                            <th>Total</th>
                            <td id="hours-total"></td>`;
        document.getElementById("hours-total").textContent = formatNumber(totalHours);
        } catch (err) {
            // document.getElementById("errmsg").innerHTML = err.stack;
        }
    </script>
</body>
</html>